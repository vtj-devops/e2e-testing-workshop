---
sidebar_position: 2
---

# E2Eテストとは？

E2Eテスト（End-to-End Testing）は、アプリケーション全体の動作をユーザー視点で検証するテスト手法です。 ブラウザを自動操作して、実際のユーザーが行う操作（クリック、入力、ナビゲーションなど）をシミュレートし、期待される結果が得られるかを確認します。

## ユニットテスト／統合テストとの違い

- ユニットテスト: 小さな部品（関数やクラス）を隔離して高速に検証する。失敗箇所の特定が容易
- 統合テスト: 複数コンポーネントの相互作用を確認するが、必ずしもUIを通さない場合がある
- E2Eテスト: UIを含む実際のユーザーフロー全体を確認するため、最も本番に近い。代わりに実行コスト（遅さ）や脆弱性（環境差異による不安定さ）が増える

## いつ書くべきか

E2Eテストはすべてを網羅するのではなく、優先度の高いユーザーフロー（クリティカルパス）に絞って書きます。プロダクトで失敗が許されない部分や、ビジネスの核心に関わる操作をまず自動化しましょう。

テスト駆動開発（TDD）などの手法もありますが、自動テストを書く習慣がない場合は、あまり細かく考えすぎず、まずは手を動かしてみることをお勧めします。

## よくある落とし穴

- UIやネットワークの遅延によりフレーク（不安定）になる
- テストが詳細すぎて実装の細かな変更で壊れやすい（実装寄りのアサーションは避ける）

### UIやネットワークの遅延によりフレーク（不安定）になる

E2Eテストは実際のブラウザを操作するため、UIの描画やネットワーク通信の遅延により、テストが不安定になることがあります。これを防ぐためには、以下の点に注意してください。

- 明示的な待機を避け、Playwrightの自動待機機能を活用する
- 適切なセレクタを使用して要素を特定する（例: `data-testid` 属性を利用）
- タイムアウトやリトライの設定を見直す

### テストが詳細すぎて実装の細かな変更で壊れやすい

E2Eテストはユーザー視点での動作確認が目的であるため、実装の細かな変更に影響されないようにすることが重要です。以下の点に注意してください。

- ユーザーが実際に見るテキストや状態をアサートする
- 内部の実装やスタイルに依存しないセレクタを使用する
- 可能な限り、ビジネスロジックに焦点を当てる
