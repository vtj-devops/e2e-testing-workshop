---
sidebar_position: 2
---

# E2Eテストとは？

このページではエンドツーエンド（E2E: end-to-end）テストの目的、範囲、他のテストとの違い、実践上の注意点を簡潔にまとめます。

## 概要

E2Eテストは、実際のユーザーが使うときの観点で、アプリケーション全体の動作を確認するテストです。フロントエンド、バックエンド、データベース、外部APIなどのコンポーネントを統合した状態で、ユーザーフロー（例: ユーザー登録、ログイン、購入など）が期待通りに完遂するかを検証します。

短く言えば「ユーザーに見える振る舞い」を自動で確かめるためのテストです。

## 何をテストするか（例）

- 画面遷移と表示の整合性
- フォーム入力からの正常/異常系の処理（バリデーション、エラーメッセージ）
- 認証や認可を含むログイン・ログアウトの一連の流れ
- 購入や決済といったビジネスクリティカルなフロー
- 外部APIやメール送信など、重要な外部依存の動作確認（必要に応じてスタブやインテグレーションで代替）

## ユニットテスト／統合テストとの違い

- ユニットテスト: 小さな部品（関数やクラス）を隔離して高速に検証する。失敗箇所の特定が容易。
- 統合テスト: 複数コンポーネントの相互作用を確認するが、必ずしもUIを通さない場合がある。
- E2Eテスト: UIを含む実際のユーザーフロー全体を確認するため、最も本番に近い。代わりに実行コスト（遅さ）や脆弱性（環境差異による不安定さ）が増える。

## いつ書くべきか

E2Eテストはすべてを網羅するのではなく、優先度の高いユーザーフロー（クリティカルパス）に絞って書きます。プロダクトで失敗が許されない部分や、ビジネスの核心に関わる操作をまず自動化しましょう。

## テストピラミッド（考え方）

テストの比率は一般的に次のように保ちます:

- ユニットテスト（多く）
- 統合テスト（中程度）
- E2Eテスト（少数だが重要）

E2Eテストは数を増やしすぎるとメンテナンス負荷と実行コストが高くなるため、目的を絞ることが重要です。

## ベストプラクティス

- クリティカルなユーザーフローに限定してテストを作る
- テストは再現性を重視する（固定データ、テスト用のDBシード、外部APIはスタブ/モックを活用）
- テストごとに独立した状態から始める（前のテストの副作用を受けない）
- テストが不安定（フレーク）な場合は原因を調査し、必要ならリトライやタイムアウト設定を見直す
- 実行時間を短く保つ（不要に長いシナリオは分割する）

## よくある落とし穴

- UIやネットワークの遅延によりフレーク（不安定）になる
- テストが環境に強く依存している（ローカルとCIで違う結果が出る）
- テストが詳細すぎて実装の細かな変更で壊れやすい（実装寄りのアサーションは避ける）

本節ではツール固有の解説（Playwright など）は行わず、E2E テストの目的と設計に集中します。ツールの使い方や具体的なサンプルは、別のセクションで詳しく扱います。

## 次のステップ

次のチュートリアルでは実際に Playwright を使ったテストの作成と実行を説明します。`tests/` ディレクトリ内の例ファイルを参照してください。
