---
sidebar_position: 4
---

# レッスン 4: テスト対象のWebサイトにアクセスしよう

今回は、テスト対象のWebサイトにアクセスし、そのWebサイトに対してテストを実行する方法を学びます。

これまでは、公式のチュートリアルの通り、Playwrightの公式ドキュメントサイトを使用していました。

これからのレッスンは、前のレッスンで起動した、ワークショップ用アプリケーションを使用します。

## 手順

`tests/example.spec.ts`を開き、以下のコードを見つけてください。

```typescript
await page.goto('https://playwright.dev/');
```

このコードは、Playwrightがテスト対象のWebサイトにアクセスするためのものです。これを、ワークショップ用に用意したサンプルアプリケーションのURLに変更します。

```typescript
await page.goto('http://localhost:5173');
```

`http://localhost:5173`は、前のレッスンで起動したアプリケーションのURLです。

変更したら、Playwright Test の UI モードでテストを再度実行してください。テストが成功することを確認してください。

## 応用

接続するWebアプリケーションによっては、画面表示に時間がかかる場合が意図した要素が表示されるよりも前にテストが進んでしまい、テストが失敗することがあります。

今回は、`page.goto`のオプションで、ページの読み込みが完了するまで待機する設定を紹介します。

```typescript
await page.goto('http://localhost:5173', { waitUntil: 'domcontentloaded' });
```

この例では、`DOMContentLoaded` イベントが発火するまで待機します。実務では、ページの「見た目上の準備完了」を評価するために、単にネットワークが落ち着くまで待つ方法（`networkidle`）に頼るのではなく、期待する要素が存在することや特定の状態を満たすことをアサーションで確認することを推奨します。

公式の `waitUntil` オプションの意味は次のとおりです。

- `load` - ページの `load` イベントが発生するまで待機します。  
- `domcontentloaded` - ページの `DOMContentLoaded` イベントが発生するまで待機します。  
- `networkidle` - DISCOURAGED: ネットワーク接続が少なくとも 500 ms 間ないと判断されたときに完了とみなします。テストではこの方法に頼らず、必要な要素や状態をアサーションで確認することを推奨します。  
- `commit` - 最初のバイトが受信され、ドキュメントの読み込みが開始されたときに完了とみなします。
